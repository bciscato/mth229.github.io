<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>MTH229 with Julia - 10&nbsp; Numeric integration with Julia</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./symbolic-math.html" rel="next">
<link href="./extrema.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./calculator.html">MTH229 notes</a></li><li class="breadcrumb-item"><a href="./integration.html"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Numeric integration with Julia</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">MTH229 with Julia</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/MTH229/mth229.github.io/tree/master/quarto/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">MTH229 notes</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./calculator.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Julia as a calculator</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Functions in Julia</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./graphing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Graphing functions with Julia</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./zeros.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Solving for zeros with julia</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./limits.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Investigating limits with Julia</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./derivatives.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Approximate derivatives in Julia</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./newton.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Newton’s method using julia</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./first-second-derivatives.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Exploring first and second derivatives with Julia</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./extrema.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Maximization and minimization with Julia</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./integration.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Numeric integration with Julia</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">MTH232 and 233</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./symbolic-math.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Using symbolic math within Julia</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mth232.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Notes on MTH 232 and Julia</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mth233.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Notes on MTH 233 and Julia</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">10.1</span> Introduction</a></li>
  <li><a href="#riemann-sums" id="toc-riemann-sums" class="nav-link" data-scroll-target="#riemann-sums"><span class="header-section-number">10.2</span> Riemann sums</a>
  <ul class="collapse">
  <li><a href="#practice" id="toc-practice" class="nav-link" data-scroll-target="#practice"><span class="header-section-number">10.2.1</span> Practice</a></li>
  </ul></li>
  <li><a href="#integrate-function" id="toc-integrate-function" class="nav-link" data-scroll-target="#integrate-function"><span class="header-section-number">10.3</span> Integrate function</a>
  <ul class="collapse">
  <li><a href="#the-integrate-function-in-action" id="toc-the-integrate-function-in-action" class="nav-link" data-scroll-target="#the-integrate-function-in-action"><span class="header-section-number">10.3.1</span> The integrate function in action</a></li>
  <li><a href="#left-versus-right" id="toc-left-versus-right" class="nav-link" data-scroll-target="#left-versus-right"><span class="header-section-number">10.3.2</span> left versus right</a></li>
  <li><a href="#practice-1" id="toc-practice-1" class="nav-link" data-scroll-target="#practice-1"><span class="header-section-number">10.3.3</span> Practice</a></li>
  </ul></li>
  <li><a href="#improvements-to-the-rectangle-method" id="toc-improvements-to-the-rectangle-method" class="nav-link" data-scroll-target="#improvements-to-the-rectangle-method"><span class="header-section-number">10.4</span> Improvements to the rectangle method</a>
  <ul class="collapse">
  <li><a href="#trapezoid-and-simpsons-rule" id="toc-trapezoid-and-simpsons-rule" class="nav-link" data-scroll-target="#trapezoid-and-simpsons-rule"><span class="header-section-number">10.4.1</span> Trapezoid and Simpson’s rule</a></li>
  <li><a href="#simpsons-rule" id="toc-simpsons-rule" class="nav-link" data-scroll-target="#simpsons-rule"><span class="header-section-number">10.4.2</span> Simpson’s rule</a></li>
  <li><a href="#error" id="toc-error" class="nav-link" data-scroll-target="#error"><span class="header-section-number">10.4.3</span> Error</a></li>
  <li><a href="#practice-2" id="toc-practice-2" class="nav-link" data-scroll-target="#practice-2"><span class="header-section-number">10.4.4</span> Practice</a></li>
  </ul></li>
  <li><a href="#the-quadgk-function" id="toc-the-quadgk-function" class="nav-link" data-scroll-target="#the-quadgk-function"><span class="header-section-number">10.5</span> The quadgk function</a>
  <ul class="collapse">
  <li><a href="#practice-3" id="toc-practice-3" class="nav-link" data-scroll-target="#practice-3"><span class="header-section-number">10.5.1</span> Practice</a></li>
  </ul></li>
  <li><a href="#applications" id="toc-applications" class="nav-link" data-scroll-target="#applications"><span class="header-section-number">10.6</span> Applications</a>
  <ul class="collapse">
  <li><a href="#volume-as-a-function-of-radius." id="toc-volume-as-a-function-of-radius." class="nav-link" data-scroll-target="#volume-as-a-function-of-radius."><span class="header-section-number">10.6.1</span> Volume as a function of radius.</a></li>
  <li><a href="#practice-4" id="toc-practice-4" class="nav-link" data-scroll-target="#practice-4"><span class="header-section-number">10.6.2</span> Practice</a></li>
  </ul></li>
  <li><a href="#example-arc-length" id="toc-example-arc-length" class="nav-link" data-scroll-target="#example-arc-length"><span class="header-section-number">10.7</span> Example, arc length</a>
  <ul class="collapse">
  <li><a href="#example-the-catenary-shape" id="toc-example-the-catenary-shape" class="nav-link" data-scroll-target="#example-the-catenary-shape"><span class="header-section-number">10.7.1</span> Example: the catenary shape</a></li>
  <li><a href="#practice-5" id="toc-practice-5" class="nav-link" data-scroll-target="#practice-5"><span class="header-section-number">10.7.2</span> Practice</a></li>
  </ul></li>
  <li><a href="#gauss-quadrature-using-weights" id="toc-gauss-quadrature-using-weights" class="nav-link" data-scroll-target="#gauss-quadrature-using-weights"><span class="header-section-number">10.8</span> Gauss quadrature, Using weights</a>
  <ul class="collapse">
  <li><a href="#adaptive-integration" id="toc-adaptive-integration" class="nav-link" data-scroll-target="#adaptive-integration"><span class="header-section-number">10.8.1</span> Adaptive integration</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/MTH229/mth229.github.io/edit/master/quarto/integration.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/MTH229/mth229.github.io/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./calculator.html">MTH229 notes</a></li><li class="breadcrumb-item"><a href="./integration.html"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Numeric integration with Julia</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Numeric integration with Julia</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<pre class="{julia}"><code>#| echo: false

import Logging
Logging.disable_logging(Logging.Info) # or e.g. Logging.Info
Logging.disable_logging(Logging.Warn)

import SymPy
function Base.show(io::IO, ::MIME"text/html", x::T) where {T &lt;: SymPy.SymbolicObject}
    println(io, "&lt;span class=\"math-left-align\" style=\"padding-left: 4px; width:0; float:left;\"&gt; ")
    println(io, "\\[")
    println(io, sympy.latex(x))
    println(io, "\\]")
    println(io, "&lt;/span&gt;")
end


nothing</code></pre>
<p><br> A notebook for this material: <a href="https://raw.githubusercontent.com/mth229/229-projects/master/10-integration.ipynb">ipynb</a></p>
<section id="introduction" class="level2" data-number="10.1">
<h2 data-number="10.1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">10.1</span> Introduction</h2>
<p>Let <span class="math inline">\(f(x)\)</span> be some non-negative, continuous function over the interval <span class="math inline">\([a,b]\)</span>. The area under the graph of <span class="math inline">\(f(x)\)</span> is given by the definite integral:</p>
<p><span class="math display">\[
\text{Area under f} = \int_a^b f(x) dx
\]</span></p>
<p>Computing this area is <em>often</em> made easier with the Fundamental Theorem of Calculus which states in one form that one can compute a definite integral through knowledge of an antiderivative. In particular, if <span class="math inline">\(F(x)\)</span> is an antiderivative for <span class="math inline">\(f(x)\)</span>, a continuous function, then</p>
<p><span class="math display">\[
\int_a^b f(x) dx = F(b) - F(a).
\]</span></p>
<p>This is great as long as some antiderivative is known. There are several different techniques for finding antiderivatives. The <code>integrate</code> function in the <code>SymPy</code> package can do many of them:</p>
<pre class="{julia}"><code>using MTH229
using Plots
plotly()</code></pre>
<pre class="{julia}"><code>#| echo: false
using QuizQuestions</code></pre>
<pre class="{julia}"><code>f(x) = x^3 - cos(x) + x*log(x)
@syms x
integrate(f(x), x)</code></pre>
<p>To find the definite integral, say from <span class="math inline">\(1\)</span> to <span class="math inline">\(10\)</span> we have:</p>
<pre class="{julia}"><code>integrate(f(x), (x, 1, 10))</code></pre>
<p>If all functions had antiderivatives that could be found symbolically, there wouldn’t be much more to say. However, it is a fact of life that not all nice functions will have an antiderivative in a convenient form. A test for such functions is provided in <a href="http://en.wikipedia.org/wiki/Risch_algorithm">Risch’s algorithm</a>. In cases where no workable antiderivative is available, the above approach is of no help. Rather, to find the area one can turn to numeric approximations that progressively get better as more approximations are taken.</p>
<p>One such approximation is given by the familiar Riemann sums, which we will look at here. However, the problem of trying to find the area of geometric figures did not start with Riemann some 150 years ago, indeed it has a much longer history. In the time of Pythagorus the idea of calculating area was one of being able to construct a square of equal area to a figure. This was known as <em>quadrature</em>. Finding such answers for figures bounded by curves was difficult, though <a href="http://en.wikipedia.org/wiki/The_Quadrature_of_the_Parabola">Archimedes</a> effectively computed the area under <span class="math inline">\(f(x) = x^2\)</span> about 2,000 years before Riemann sums using triangles, not rectangles to approximate the area. By medieval Europe, the term <em>quadrature</em> evolved to be the computation of an area by any means. For example, <a href="http://en.wikipedia.org/wiki/Quadrature_(mathematics)">Galileo and Roberval</a> found the area bounded by a cycloid arch. Along the way, other approximations were used. We will see those due to Simpson and Gauss, both predating Riemann.</p>
</section>
<section id="riemann-sums" class="level2" data-number="10.2">
<h2 data-number="10.2" class="anchored" data-anchor-id="riemann-sums"><span class="header-section-number">10.2</span> Riemann sums</h2>
<p>In 1854 Riemann was the first to give a rigorous definition of the integral of a continuous function on a closed interval, the problem we wish to solve here, using the concept of a <em>Riemann sum</em>. A Riemann sum is one of the simplest to understand approximations to the area under a curve. The basic idea is that the interval <span class="math inline">\([a,b]\)</span> is partitioned through points <span class="math inline">\(a = x_0 &lt; x_1 &lt; \cdots x_n = b\)</span> and the area under <span class="math inline">\(f(x)\)</span> between <span class="math inline">\(x_i\)</span> and <span class="math inline">\(x_{i+1}\)</span> is approximated by a rectangle with the base <span class="math inline">\(x_{i+1} - x_i\)</span> and height given by <span class="math inline">\(f(x_i^*)\)</span>, where <span class="math inline">\(x_i^*\)</span> is some point in the interval <span class="math inline">\([x_i, x_{i+1}]\)</span>. Typical choices are the left point or the right point of the interval, or the <span class="math inline">\(x\)</span> value which minizes or maximizes <span class="math inline">\(f\)</span> over the interval. The figure shows these four choices for some sample function. For a <em>Riemann integrable</em> function, such as a continuous function on <span class="math inline">\([a,b]\)</span>, any of the choices will yield the same value as the partition’s mesh shrinks to <span class="math inline">\(0\)</span>.</p>
<pre class="{julia}"><code>#| echo: false
#| fig-alt: "A simple Riemann partition"
#![Riemann](figures/integration/riemann_choice.png){fig-alt="A simple Riemann partition"}

g(x) = -x^4 + 2x^2 + 2;
f(x) = g(x-1/2)
grey = RGBA(.5, .5, .5, 0.5)

xlims = (-2, 2)
cps = find_zeros(f', xlims)
m, M = minimum(f.(xlims)), maximum(f.(cps))
ylims=(m, M+1)
p = plot(;xlims = (-2.1, 2.1), ylims=ylims,
         legend=false,
         axis=([], false))

plot!(f; linecolor=:black, linewidth=2)
plot!([xlims...], [m,m]; linecolor=:black, linewidth=2)

# left
xs = range(0, 1, length=100)
_xs = [0,1,1,0,0]
fill = (:grey, 0.1,0)

# right
plot!(-2 .+ _xs, [m,m,f(-1),f(-1), m]; linecolor=:black, linewidth=1, fill=fill)

# leftt
plot!(-1 .+ _xs, [m,m,f(-1),f(-1), m]; linecolor=:black, linewidth=1,fill=fill)
plot!([0,0],[f(-1),f(0)]; linecolor=:black, linewidth=1)

# min
cp = 0.5
plot!(0 .+ _xs, [m,m,f(cp),f(cp), m]; linecolor=:black, linewidth=1, fill=fill)

# max
cp = 1.5
plot!(1 .+ _xs, [m,m,f(cp),f(cp), m]; linecolor=:black, linewidth=1, fill=fill)

ycenter = -15
annotate!([(-1.5, ycenter, text("right",:center)),
           (-0.5, ycenter, text("left",:center)),
           ( 0.5, ycenter, text("min",:center)),
           ( 1.5, ycenter, text("max",:center))
           ])</code></pre>
<p>As with other limits, we can numerically approximate the limit by computing the Riemann sum for some partition. The steps for this include:</p>
<ul>
<li>creating a partition of <span class="math inline">\([a,b]\)</span>. We will use evenly spaced points for convenience.</li>
<li>Selecting the <span class="math inline">\(x_i^*\)</span> within the partition</li>
<li>Computing the values <span class="math inline">\(f(x_i^*)(x_{i+1} - x_i)\)</span> for each <span class="math inline">\(i\)</span></li>
<li>adding these values up</li>
</ul>
<p>If we partition <span class="math inline">\([a,b]\)</span> into <span class="math inline">\(n\)</span> same sized intervals, then each has length <span class="math inline">\(\delta = (b-a)/n\)</span> and so the points are separated by this amount. As such, we can choose our <span class="math inline">\(a = x_0 &lt; x_1 &lt; \dots &lt; x_n = b\)</span> with commands like:</p>
<pre class="{julia}"><code>a, b, n = 1, 3, 5;
delta = (b-a)/n;
xs = a .+ (0:n) * delta</code></pre>
<p>To apply a function to a range of values, we may use a map, a comprehension, a <code>for</code> loop or the “dot” notation. We will use broadcasting here. Recall, the syntax:</p>
<pre class="{julia}"><code>f(x) = x^2
fxs = f.(xs)</code></pre>
<p>Now to add the numbers up. For this task, the <code>sum</code> function is available</p>
<pre class="{julia}"><code>sum(fxs)</code></pre>
<p>Okay, just one subtlety, we really only want the points</p>
<pre class="{julia}"><code>[ a .+ (0:n-1) * delta ]</code></pre>
<p>for the left Riemann sum and the points</p>
<pre class="{julia}"><code>[ a .+ (1:n) * delta ]</code></pre>
<p>for the right.</p>
<p>Putting this together, here are commands to approximate the area under the curve <span class="math inline">\(f(x)=x^2\)</span> using 10 left Riemann sums:</p>
<pre class="{julia}"><code>f(x) = x^2
a, b, n = 1, 3, 10;        ## note n=10
delta = (b - a)/n;         ## nothing to change below here
xs = a .+ (0:n-1) * delta;          ## n, right is 1:n * delta
fxs = f.(xs);
sum(fxs) * delta</code></pre>
<p>We compare this value to the known value from the Fundamental Theorem of Calculus, as <span class="math inline">\(F(x) = x^3/3\)</span> is an antiderivative:</p>
<pre class="{julia}"><code>F(x) = x^3/3
F(b) - F(a)</code></pre>
<p>Boy, not too close. We need a better approximation of course. This can be achieved by using larger values for <code>n</code>.</p>
<section id="practice" class="level3" data-number="10.2.1">
<h3 data-number="10.2.1" class="anchored" data-anchor-id="practice"><span class="header-section-number">10.2.1</span> Practice</h3>
<section id="question" class="level4">
<h4 class="anchored" data-anchor-id="question">Question</h4>
<p>Repeat with n=100</p>
<p>For the same problem, let <span class="math inline">\(n=100\)</span>. What do you get?</p>
<pre class="{julia}"><code>#| echo: false
f(x) = x.^2
a=1; b=3; n=100;
x = range(a, stop=b, length=n+1);
val = sum(f(x[1:n])) * (b-a)/n;
numericq(val, 1e-4)</code></pre>
</section>
<section id="question-1" class="level4">
<h4 class="anchored" data-anchor-id="question-1">Question</h4>
<p>Repeat with n=1,000</p>
<p>For the same problem, let <span class="math inline">\(n=1000\)</span>. What do you get?</p>
<pre class="{julia}"><code>#| echo: false
f(x) = x.^2
a=1; b=3; n=1000;
x = range(a, stop=b, length=n+1);
val = sum(f(x[1:n])) * (b-a)/n;
numericq(val, 1e-4)</code></pre>
</section>
<section id="question-2" class="level4">
<h4 class="anchored" data-anchor-id="question-2">Question</h4>
<p>Repeat with n=10,000</p>
<p>For the same problem, let <span class="math inline">\(n=10,000\)</span>. is the difference between the answer and the actual answer within <span class="math inline">\(0.001\)</span>?</p>
<pre class="{julia}"><code>#| echo: false
f(x) = x.^2
a=1; b=3; n=10_000;
x = range(a, stop=b, length=n+1);
val = sum(f(x[1:n])) * (b-a)/n;
F(x) = x^3/3
booleanq(abs(F(b) - F(a) - val) &lt; 1e-3)</code></pre>
</section>
<section id="question-3" class="level4">
<h4 class="anchored" data-anchor-id="question-3">Question</h4>
<p>How big should n be? (Strang)</p>
<p>Let <span class="math inline">\(f(x) = (10 + \cos(2\pi x))^{-1}\)</span>. For the integral over <span class="math inline">\([0,1]\)</span>, the known answer is <span class="math inline">\(1/\sqrt{99}\)</span>. How big must <span class="math inline">\(n\)</span> be so that the error in the Riemann sum is less than <span class="math inline">\(10^{-8}\)</span>?</p>
<pre class="{julia}"><code>#| echo: false
## This integral converges very fast, as the function is symmetric over the interval so the errors cancel out.
choices = [5, 10, 100, 1_000, 10_000];
radioq(choices, 2)</code></pre>
</section>
</section>
</section>
<section id="integrate-function" class="level2" data-number="10.3">
<h2 data-number="10.3" class="anchored" data-anchor-id="integrate-function"><span class="header-section-number">10.3</span> Integrate function</h2>
<p>Here we write a function to do the integration. This needs the basic inputs of</p>
<ul>
<li>a function,</li>
<li>the interval’s start and end value, and</li>
<li>the number of equal-sized subintervals.</li>
</ul>
<p>In addition, we allow for the possibility of using different methods to approximate the area over a sub interval. Different possibilities are:</p>
<ul>
<li>using a rectangle with the left endpoint to determine the height (<code>method="left"</code>)</li>
<li>using a rectangle with the right endpoint to determine the height (<code>method="right"</code>)</li>
<li>using a trapezoid formed by joining the left and right endpoints (<code>method="trapezoid"</code>)</li>
<li>making the cap a quadratic polynomial that goes through the left and right endpoints and the midpoint (<code>method="simpsons"</code>)</li>
</ul>
<p>For pedagocial use, this function is defined in <code>MTH229</code>:</p>
<pre class="{julia}"><code>#| eval: false
function riemann(f::Function, a::Real, b::Real, n::Int; method="right")

    xs = range(a, b, length=n+1)
    lrs = zip(xs[1:n], xs[2:n+1])

    if method == "right"

        sum(f(r) * (r-1) for (l,r) in lrs)

    elseif method == "left"

        sum(f(l) * (r-1) for (l,r) in lrs)

    elseif method == "trapezoid"

        (1/2) * sum((f(l) + f(r)) * (r-l) for (l,r) in lrs)

    elseif method == "simpsons"

        (1/6) * sum((f(l) + 4*(f((l+r)/2)) + f(r)) * (r-l) for (l,r) in lrs)

    end

end</code></pre>
<section id="the-integrate-function-in-action" class="level3" data-number="10.3.1">
<h3 data-number="10.3.1" class="anchored" data-anchor-id="the-integrate-function-in-action"><span class="header-section-number">10.3.1</span> The integrate function in action</h3>
<p>The basic usage of the <code>riemann</code> function is straightforward. Here we approximate the integral of <span class="math inline">\(e^{-x^2}\)</span> from <span class="math inline">\(0\)</span> to <span class="math inline">\(3\)</span> using <span class="math inline">\(10,000\)</span> subintervals:</p>
<pre class="{julia}"><code>f(x) =  exp(-x^2)
riemann(f, 0, 3, 10_000)</code></pre>
<p>How big should the number of intervals be? More intervals will give better answers, but unlike Newton’s method we have no stopping criteria. For this problem, we look at various values based on <code>n</code>:</p>
<pre class="{julia}"><code>[riemann(f, 0, 3, n) for n in [100, 1000, 10000, 100000]]   ## or use 10.^(2:5)</code></pre>
<p>We see a value around <span class="math inline">\(0.886\)</span> as the answer.</p>
</section>
<section id="left-versus-right" class="level3" data-number="10.3.2">
<h3 data-number="10.3.2" class="anchored" data-anchor-id="left-versus-right"><span class="header-section-number">10.3.2</span> left versus right</h3>
<p>Using different methods allows us to compare the right and left Riemann sums. Let’s do so for the monotonic function <span class="math inline">\(e^x\)</span> over the interval <span class="math inline">\([0,2]\)</span>.</p>
<pre class="{julia}"><code>f(x) = exp(x)
ns = [10^i for i in 1:5]
ys = [riemann(f, 0, 2, n, method="right") - riemann(f, 0, 2, n, method="left") for n in ns];
[ns ys]</code></pre>
<p>Since these are also the minimum and maximum Riemann sums, the above gives a bound on the error in the approximations. We can see it converges quite slowly, in that there are quite a few computations needed to get even a modest bound. (<span class="math inline">\(100,000\)</span> for <span class="math inline">\(0.00013\)</span>).</p>
</section>
<section id="practice-1" class="level3" data-number="10.3.3">
<h3 data-number="10.3.3" class="anchored" data-anchor-id="practice-1"><span class="header-section-number">10.3.3</span> Practice</h3>
<section id="question-4" class="level4">
<h4 class="anchored" data-anchor-id="question-4">Question</h4>
<p>Compute the integral of <span class="math inline">\(e^{-x^2}\)</span> over <span class="math inline">\([0,1]\)</span> using a right Riemann sum with <span class="math inline">\(n=10_000\)</span>. What is your answer?</p>
<pre class="{julia}"><code>#| echo: false
f(x) = exp(-x^2)
a,b,n = 0, 1, 10_000
val = riemann(f, a, b, n, method="right")
numericq(val, 1e-8)</code></pre>
</section>
<section id="question-5" class="level4">
<h4 class="anchored" data-anchor-id="question-5">Question</h4>
<p>Compute the integral of <span class="math inline">\((1 + \cos(x)^2)^{1/2}\)</span> over the interval <span class="math inline">\([0, \pi]\)</span> using a right Riemann sum with <span class="math inline">\(n=10,000\)</span>. What is your answer?</p>
<pre class="{julia}"><code>#| echo: false
f(x) = sqrt(1 + cos(x)^2)
a, b, n = 0, pi, 10_000
val = riemann(f, a, b, n, method="right")
numericq(val, 1e-8)</code></pre>
</section>
<section id="question-6" class="level4">
<h4 class="anchored" data-anchor-id="question-6">Question</h4>
<p>Repeat the above analysis comparing the right and left Riemann sums for <span class="math inline">\(f(x)=e^x\)</span> over <span class="math inline">\([0,2]\)</span>. However, this time multiply by <span class="math inline">\(n\)</span>, as follows:</p>
<pre class="{julia}"><code>ns = [10^i for i in 1:5]
f(x) = exp(x)
[n * (riemann(f, 0, 2, n, method="right") - riemann(f, 0, 2, n, method="left")) for n in ns]</code></pre>
<p>This shows what?</p>
<pre class="{julia}"><code>#| echo: false
choices = ["That it is constant says the difference between right and left Riemann sums never goes to 0",
        "That it is constant says the difference between right and left Riemann sums goes to 0 like 1/n",
        "That it is constant says the difference between right and left Riemann sums is constant."
        ];
answer = 2;
radioq(choices, answer)</code></pre>
</section>
</section>
</section>
<section id="improvements-to-the-rectangle-method" class="level2" data-number="10.4">
<h2 data-number="10.4" class="anchored" data-anchor-id="improvements-to-the-rectangle-method"><span class="header-section-number">10.4</span> Improvements to the rectangle method</h2>
<p>The basic left or right Riemann sum will converge, but the convergence is really slow. The value of using rectangles over a grid to approximate area is for theoretical computations, for numeric computations better approximations were known well before Riemann. We mention a few:</p>
<ul>
<li>The trapezoid rule and Simpson’s rule approximate the area under the curve better, as instead of a rectangle they use a trapezoid (linear fit between two points) or a quadratic fit between the two points.)</li>
<li>Gauss quadrature uses non-evenly selected points within the range and a weighting which is exact for polynomials of a given degree.</li>
<li>Adaptive methods pick a non-uniform set of points to use based on where a function is less well behaved.</li>
</ul>
<section id="trapezoid-and-simpsons-rule" class="level3" data-number="10.4.1">
<h3 data-number="10.4.1" class="anchored" data-anchor-id="trapezoid-and-simpsons-rule"><span class="header-section-number">10.4.1</span> Trapezoid and Simpson’s rule</h3>
<p>The trapezoid rule simply replaces the approximation of the area in a subinterval by a trapezoid, as opposed to a rectangle.</p>
<p>We can use this as follows. Let’s approximate the area under the curve <span class="math inline">\(y=5x^4\)</span> between <span class="math inline">\(0\)</span> and <span class="math inline">\(1\)</span> (with known answer <span class="math inline">\(1\)</span>):</p>
<pre class="{julia}"><code>f(x) = 5x^4
riemann(f, 0, 1, 1000, method="trapezoid")</code></pre>
<p>Pretty close to 1 with just 1,000 subintervals.</p>
<p>We now compare the error with the left Riemann sum for the same size <span class="math inline">\(n\)</span>:</p>
<pre class="{julia}"><code>ns = [10^i for i in 1:5]
left_r = [riemann(f, 0, 1, n) for n in ns];
trapezoid_r = [riemann(f, 0, 1, n, method="trapezoid") for n in ns];
[ns (1).-left_r (1).-trapezoid_r]</code></pre>
<p>One can see that the errors are much smaller for the trapezoid method.</p>
</section>
<section id="simpsons-rule" class="level3" data-number="10.4.2">
<h3 data-number="10.4.2" class="anchored" data-anchor-id="simpsons-rule"><span class="header-section-number">10.4.2</span> Simpson’s rule</h3>
<p>The trapezoid rule can be viewed as a simple linear approximation to the function <span class="math inline">\(f(x)\)</span> over the subinterval <span class="math inline">\([a, b]\)</span>. That is, replace the function with the secant line between these two values and integrate the replacement. With this viewpoint, it is possible that other easy-to-integrate function approximations will lead to improved approximate integrals. Simpson’s method can be viewed in just this way. It replaces <span class="math inline">\(f\)</span> by the parabola going through <span class="math inline">\((a, f(a))\)</span>, <span class="math inline">\((c, f( c))\)</span> and <span class="math inline">\((b, f(b))\)</span> where <span class="math inline">\(c=(a+b)/2\)</span> is the midpoint between <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span>.</p>
<p>We compare how accurate we get with this rule for the same <code>f</code> as before:</p>
<pre class="{julia}"><code>simpsons_r = [riemann(f, 0, 1, n, method="simpsons") for n in ns];
[ns (1).-left_r (1).-trapezoid_r (1).-simpsons_r]
</code></pre>
<p>As can be seen, for this function approximating with a parabola is much quicker to converge. That is, <span class="math inline">\(n\)</span> can be smaller yet the same accuracy is maintained. (Of course, there are more computations involved for each, so the number of operations needed may or may not be fewer, that would require some analysis.)</p>
</section>
<section id="error" class="level3" data-number="10.4.3">
<h3 data-number="10.4.3" class="anchored" data-anchor-id="error"><span class="header-section-number">10.4.3</span> Error</h3>
<p>It can be shown that the <a href="http://en.wikipedia.org/wiki/Simpson%27s_rule#Error">error for Simpson’s method</a> is bounded by</p>
<p><span class="math display">\[
\frac{1}{90}\frac{1}{2^5} M (b-a)^5 \frac{1}{n^4},
\]</span></p>
<p>where <span class="math inline">\(M\)</span> is a bound on the fourth derivative. As we increase <span class="math inline">\(n\)</span>, the error gets small at a quick rate. By contrast, the error for the trapezoid method will be like <span class="math inline">\(n^{-2}\)</span> and the left Riemann sum like <span class="math inline">\(n^{-1}\)</span>.</p>
</section>
<section id="practice-2" class="level3" data-number="10.4.4">
<h3 data-number="10.4.4" class="anchored" data-anchor-id="practice-2"><span class="header-section-number">10.4.4</span> Practice</h3>
<section id="question-7" class="level4">
<h4 class="anchored" data-anchor-id="question-7">Question</h4>
<p>The trapezoid rule has no error for linear functions and Simpson’s rule has no error for quadratic functions. Verify the latter by computing the following:</p>
<pre class="{julia}"><code>f(x) = x^2; F(x) = x^3/3
riemann(f, 0, 10, 100, method="simpsons") - (F(10) - F(0))</code></pre>
<p>How accurate is the approximation? Around</p>
<pre class="{julia}"><code>#| echo: false
choices = [`1e-8`, `1e-10`, `1e-12`, `1e-14`, `1e-16`, `0`];
answer = 4;
radioq(choices, answer, keep_order=true)</code></pre>
</section>
<section id="question-8" class="level4">
<h4 class="anchored" data-anchor-id="question-8">Question</h4>
<p>Compare the difference between the trapezoid rule and Simpson’s rule when integrating <span class="math inline">\(\cos(x)\)</span> from <span class="math inline">\(0\)</span> to <span class="math inline">\(\pi/6\)</span>. How big is the difference when <span class="math inline">\(n=10,000\)</span>?</p>
<pre class="{julia}"><code>a, b, n = 0, pi/6, 10_000
riemann(cos, a, b, n, method="trapezoid") - riemann(cos, a, b, n, method="simpsons")</code></pre>
<p>How big is the difference?</p>
<pre class="{julia}"><code>#| echo: false
choices = [`1e-8`, `1e-10`, `1e-12`, `1e-14`, `1e-16`, `0`];
answer = 2;
radioq(choices, answer, keep_order=true)</code></pre>
</section>
<section id="question-." class="level4">
<h4 class="anchored" data-anchor-id="question-.">Question ….</h4>
<p>Using Simpson’s rule and <code>n=1000</code> compute the integral of <span class="math inline">\(f(x) = 1/(1+x^2)\)</span> between <span class="math inline">\(0\)</span> and <span class="math inline">\(1\)</span>.</p>
<pre class="{julia}"><code>#| echo: false
a,b,n = 0, 1, 1000
val = riemann(x -&gt; 1/(1+x^2), a, b, n, method="simpsons");
numericq(val, 1e-5)</code></pre>
</section>
</section>
</section>
<section id="the-quadgk-function" class="level2" data-number="10.5">
<h2 data-number="10.5" class="anchored" data-anchor-id="the-quadgk-function"><span class="header-section-number">10.5</span> The quadgk function</h2>
<p><code>Julia</code> provides the <code>quadgk</code> function to do adaptive Gauss-Konrod quadrature, a modern, fast and accurate means to compute 1-dimensional integrals numerically. This is in the <code>QuadGK</code> package which is loaded with <code>MTH229</code>.</p>
<p>The use is straightforward, and similar to <code>riemann</code> above: you specify a function object, and the limits of integration. You don’t specify <span class="math inline">\(n\)</span> – as this is computed adaptively – but you can optionally specify a tolerance which controls the accuracy, though we don’t do so here. For example, a typical usage might be:</p>
<pre class="{julia}"><code>a, err = quadgk(sin, 0, pi)     ## 2 is exact</code></pre>
<p>Two values are returned, the answer and an estimate of the error. In the above, <span class="math inline">\(2\)</span> is the exact answer to this integral, the estimated value a just a bit more <span class="math inline">\(2\)</span>, but is estimated to be off my no more than the second value, <span class="math inline">\(1.78 \cdot 10^{-12}\)</span>.</p>
<p>If just the answer is of interest, then it can be extracted using <em>index notation</em>:</p>
<pre class="{julia}"><code>quadgk(sin, 0, pi)[1]       # [1] picks out the first component or two</code></pre>
<hr>
<p>For another illustration, since Archimedes the known answer for <span class="math inline">\(\int_0^1 x^2 dx\)</span> is <span class="math inline">\(1/3\)</span>. We see that <code>quadgk</code> gets it right for all the digits:</p>
<pre class="{julia}"><code>quadgk(x -&gt; x^2, 0, 1)</code></pre>
<p>The <code>riemann</code> function is good for pedagogical purposes, but the <code>quadgk</code> function should be used instead of the <code>riemann</code> function – besides being built-in to <code>Julia</code> it is more accurate, more robust, fast, and less work to use.</p>
<p>(That <code>quadgk</code> is exact with polynomials is no surprise, as the underlying choice of nodes and weights makes it so for polynomials of certain degree.)</p>
<section id="practice-3" class="level3" data-number="10.5.1">
<h3 data-number="10.5.1" class="anchored" data-anchor-id="practice-3"><span class="header-section-number">10.5.1</span> Practice</h3>
<section id="question-use-quadgk" class="level4">
<h4 class="anchored" data-anchor-id="question-use-quadgk">Question: Use quadgk</h4>
<p>Let <span class="math inline">\(f(x) = \exp(-4 \cdot  |x-1/2|)\)</span>. Find the integral over <span class="math inline">\([0,1]\)</span> using <code>quadgk</code>:</p>
<pre class="{julia}"><code>#| echo: false
f(x) = exp(-4*abs(x-1/2))
val = quadgk(f, 0, 1)[1];
numericq(val, 1e-5)</code></pre>
</section>
<section id="question-use-quadgk-1" class="level4">
<h4 class="anchored" data-anchor-id="question-use-quadgk-1">Question: use quadgk</h4>
<p>Let <span class="math inline">\(f(x) = \sin(100\pi x)/(\pi x)\)</span>. Find the integral over <span class="math inline">\([0,1]\)</span> using <code>quadgk</code>:</p>
<pre class="{julia}"><code>#| echo: false
f(x) = sin(100pi *x)/(pi*x);
val = quadgk(f, 0, 1)[1];
numericq(val, 1e-4)</code></pre>
</section>
<section id="question-9" class="level4">
<h4 class="anchored" data-anchor-id="question-9">Question</h4>
<p>Let <span class="math inline">\(f(x) = \sin(100\pi x)/(\pi x)\)</span>. Using <span class="math inline">\(1,000\)</span> points, find the right-Riemann integral over <span class="math inline">\([0,1]\)</span>.</p>
<pre class="{julia}"><code>#| echo: false
f(x) = sin(100*pi*x)/(pi*x)
a, b, n = 0, 1, 1000
val = riemann(f, a, b, n, method="right")
numericq(val, 1e-5)</code></pre>
<p>(The answer via Riemann sums isn’t even correct to 4 decimal points, due to the highly oscillatory nature of the function.)</p>
</section>
<section id="question-10" class="level4">
<h4 class="anchored" data-anchor-id="question-10">Question</h4>
<p>How far off is this Riemann estimate, when <span class="math inline">\(n=100,000\)</span>?</p>
<pre class="{julia}"><code>f(x) = 1/(1 + x^4)
quadgk(f, 0, 1)[1] - riemann(f, 0, 1, 100_000);</code></pre>
<pre class="{julia}"><code>#| echo: false
choices = ["Roughly `1e-4`",
         "Roughly `1e-6`",
         "Roughly `1e-12`"
         ];
answer = 2;
radioq(choices, answer)</code></pre>
</section>
<section id="question-11" class="level4">
<h4 class="anchored" data-anchor-id="question-11">Question</h4>
<p>The <code>quadgk</code> function allows you to specify issues where there are troubles. For example, we know that <span class="math inline">\(f(x) = \sin(x)/x\)</span> has an issue at 0. Directly trying this integral <code>quadgk(x-&gt;sin(x)/x, -pi, pi)</code> will fail, but you can specify the issue at <span class="math inline">\(0\)</span> as follows <code>quadgk(x -&gt; sin(x)/x, -pi, 0, pi)</code>. Do so. What is the value of the result:</p>
<pre class="{julia}"><code>#| echo: false
val = quadgk(x -&gt; sin(x)/x, -pi, 0, pi)[1];
numericq(val, 1e-4)</code></pre>
</section>
<section id="question-12" class="level4">
<h4 class="anchored" data-anchor-id="question-12">Question</h4>
<p>Let <span class="math inline">\(f(x) = |x - 0.3|^{-1/4}\)</span>. We wish to find <span class="math inline">\(\int_0^1 f(x) dx\)</span>. The problem with this function is the singularity at <span class="math inline">\(x=0.3\)</span>. (That is, the function is not continuous, so has no guarantee that an integral over a closed domain exists.) However, some such integrals do exist, and the <code>quadgk</code> function can integrate around such singularities by spelling them out in the domain of integration. Just specify the trouble spots between the endpoints:</p>
<pre class="{julia}"><code>f(x) = abs(x - 0.3)^(-1/4)
val = quadgk(f, 0, 0.3, 1);</code></pre>
<p>Following the above, what answer do you get?</p>
<pre class="{julia}"><code>#| echo: false
numericq(val[1], 1e-4)</code></pre>
</section>
</section>
</section>
<section id="applications" class="level2" data-number="10.6">
<h2 data-number="10.6" class="anchored" data-anchor-id="applications"><span class="header-section-number">10.6</span> Applications</h2>
<p>There are many more applications of the integral beyond computing areas under the curve. Here we discuss two:</p>
<ul>
<li>finding the volume of a figure with rotational symmetry (a glass in our example) and</li>
<li>finding the arc length of a line.</li>
</ul>
<p>In each case one integrates a function related to the one describing the problem. If you keep this straight, the applications are no different than above.</p>
<section id="volume-as-a-function-of-radius." class="level3" data-number="10.6.1">
<h3 data-number="10.6.1" class="anchored" data-anchor-id="volume-as-a-function-of-radius."><span class="header-section-number">10.6.1</span> Volume as a function of radius.</h3>
<p>The volume of a solid of revolution about the <span class="math inline">\(y\)</span>-axis is illustrated <a href="https://www.khanacademy.org/math/integral-calculus/solid_revolution_topic/disc-method/v/disc-method-around-y-axis">here</a>.</p>
<p>This figure shows a volume of revolution (a glass) with an emphasis on the radius of the solid. The volume can be determined if the radius is known.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures/integration/integration-glass.jpg" class="img-fluid figure-img"></p>
<figcaption>Glass</figcaption>
</figure>
</div>
<p>The basic formula requires the description of the radius as a function of <span class="math inline">\(x\)</span> (if oriented as the figure) or the height, <span class="math inline">\(h\)</span>, (if oriented as in real life). Suppose we specify the radius with <span class="math inline">\(r(h)\)</span>, then the following formula holds with <span class="math inline">\(b\)</span> the total height.</p>
<p><span class="math display">\[
V(b) = \int_0^b \pi r(h)^2 dh.
\]</span></p>
<p>For a symmetrical drinking vessel, like most every glass you drink from, the volume can be computed from a formula if a function describing the radius is known. For a given glass, let <span class="math inline">\(r(h)\)</span> give the radius as a function of height. Then, as above, the volume of the vessel as a function of height, <span class="math inline">\(b\)</span>, is given by an integral:</p>
<p><span class="math display">\[
V(b) = \int_0^b \pi (r(h))^2 dh
\]</span></p>
<p>We wish to look at our intuition relating the height of the fluid in the vessel compared to the percentage of fluid of the whole. A basic question might be: If the vessel is filled half way by height, is the volume half of the total, more or less?</p>
<p>The answer, of course, depends on the shape of the glass. That is the shape of the function <span class="math inline">\(r(h)\)</span>. Note, if <span class="math inline">\(r(h)\)</span> is a constant – the glass is a cylinder – then the half-height mark is also the half-volume mark. Not so in general.</p>
<p>For a standard measuring cup, the answer for different <code>b</code>’s is printed on the side:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures/integration/measuring_cup.png" class="img-fluid figure-img"></p>
<figcaption>Measuring cup</figcaption>
</figure>
</div>
<p>With the formula for the volume of a solid of revolution we can compute this marks numerically if we know the radius as a function of height.</p>
<p>In Glass Shape Influences Consumption Rate for <a href="http://www.plosone.org/article/info%3Adoi%2F10.1371%2Fjournal.pone.0043007">Alcoholic Beverages</a> the authors demonstrate that the shape of the glass can have an effect on the rate of consumption, presumably people drink faster when they aren’t sure how much they have left. In particular, they comment that people have difficulty judging the half-finished-by-volume mark.</p>
<p>This figure shows some of the wide variety of beer-serving glasses:</p>
<p><a href="figures/integration/beer_glasses.jpg">Beer glasses</a></p>
<p>We work with metric units, as there is a natural relation between volume in cm<span class="math inline">\(^3\)</span> and liquid measure (1 liter = 1000 cm<span class="math inline">\(^3\)</span>, so a 16-oz pint glass is roughly <span class="math inline">\(450\)</span> cm<span class="math inline">\(^3\)</span>.)</p>
<p>Let two glasses be given as follows. A typical pint glass with linearly increasing radius:</p>
<p><span class="math display">\[
r(h) = 3 + \frac{1}{5}h, \quad 0 \leq h \leq b;
\]</span></p>
<p>and a curved edge one:</p>
<p><span class="math display">\[
s(h) = 3 + \log(1 + h), \quad 0 \leq h \leq b
\]</span></p>
<p><a href="figures/integration/glass-half-full.png">Half full</a></p>
<p>One could also consider a fluted one, such as appears in the comparison noted in the article.</p>
<section id="question-13" class="level4">
<h4 class="anchored" data-anchor-id="question-13">Question</h4>
<p>Which of these functions might describe a fluted glass where the radius changes faster as the height gets bigger, that is the radius is a <em>concave up</em> function?</p>
<pre class="{julia}"><code>#| echo: false
choices = ["`r(h) = 2 + (h/10)^2, 0 &lt;= h &lt;= 10`",
         "`r(h) = 2 + sqrt(h/10), 0 &lt;= h &lt;= 10`",
         "`r(h) = 2 + h/10, 0 &lt;= h &lt;= 10`"
         ];
answer = 1;
radioq(choices, answer)</code></pre>
<hr>
<p>For the two types of glasses in the figure, we create functions in <code>Julia</code> as follows:</p>
<pre class="{julia}"><code>r(h) = 3 + h/5
s(h) = 3 + log(1 + h)
r_vol(b) = quadgk(x -&gt; pi*r(x)^2, 0, b)[1]
s_vol(b) = quadgk(x -&gt; pi*s(x)^2, 0, b)[1]</code></pre>
<p>Then we can easily find the volume as a function of height. For example at 10cm we have:</p>
<pre class="{julia}"><code>(r_vol(10), s_vol(10))</code></pre>
<p>However, to find <span class="math inline">\(b\)</span> that makes the glass <span class="math inline">\(450\)</span> cm<span class="math inline">\(^3\)</span> requires us to solve an equation involving an integral for <span class="math inline">\(b\)</span>:</p>
<p><span class="math display">\[
V(b) = \int_0^b \pi r(h)^2 dh = 450.
\]</span></p>
<p>Not to worry, we can use <code>find_zero</code> from the <code>Roots</code> package for that (again, this is loaded with the <code>MTH229</code> package). To solve for when <code>V(b) = r_vol(b) - 450 = 0</code> we have</p>
<pre class="{julia}"><code>r_b = find_zero(x -&gt; r_vol(x) - 450,  10)</code></pre>
<p>So <span class="math inline">\(b\)</span> is basically <span class="math inline">\(9.17\)</span>. Given this, how much volume is left at <code>b/2</code>?</p>
<pre class="{julia}"><code>r_vol(r_b/2)</code></pre>
<p>Which is what percent of the whole?</p>
<pre class="{julia}"><code>r_vol(r_b/2) / r_vol(r_b) * 100</code></pre>
<p>As this height is often mistaken for the half-way by volume mark, people tend to drink these pints faster than they think.</p>
<p>Now compare to the height to get half the volume (225 ml):</p>
<pre class="{julia}"><code>r_half = find_zero(x -&gt; r_vol(x) - 225,  5)</code></pre>
<p>This value is more than half of <span class="math inline">\(b\)</span>:</p>
<pre class="{julia}"><code>r_half / r_b</code></pre>
<p>At this height only half the volume is remaining (and not at 50% of the original height.)</p>
</section>
</section>
<section id="practice-4" class="level3" data-number="10.6.2">
<h3 data-number="10.6.2" class="anchored" data-anchor-id="practice-4"><span class="header-section-number">10.6.2</span> Practice</h3>
<section id="question-14" class="level4">
<h4 class="anchored" data-anchor-id="question-14">Question</h4>
<p>Compare the above for the curved glass, where <span class="math inline">\(s(h) = 3 + \log(1 + h)\)</span>.</p>
<p>What is the height of the glass, <code>b</code>, needed to make the volume 450?</p>
<pre class="{julia}"><code>#| echo: false
s(h) = 3 + log(1 + h)
s_vol(b) = quadgk(x -&gt; pi*s(x)^2, 0, b)[1]
b = find_zero(x -&gt; s_vol(x) - 450, 8);
val = b
numericq(val, 1e-3)</code></pre>
</section>
<section id="question-15" class="level4">
<h4 class="anchored" data-anchor-id="question-15">Question</h4>
<p>Find the volume of the glass represented by <span class="math inline">\(s(h) = 3 + \log(1 + h), 0 \leq h \leq b\)</span> when the glass is filled to half its height. Report the value as a percentage of the total volume.</p>
<pre class="{julia}"><code>#| echo: false
val = s_vol(b/2) / s_vol(b) * 100;
numericq(val,1)</code></pre>
</section>
<section id="question-16" class="level4">
<h4 class="anchored" data-anchor-id="question-16">Question</h4>
<p>Now how high do you fill the glass to produce <em>half</em> the volume? Report your answer in terms of a percentage of <span class="math inline">\(b\)</span>, the height of the glass.</p>
<pre class="{julia}"><code>#| echo: false
b12 = find_zero(x -&gt; s_vol(x) - 450/2, 4)
val = b12/b*100;
numericq(val, .1)</code></pre>
</section>
<section id="question-17" class="level4">
<h4 class="anchored" data-anchor-id="question-17">Question</h4>
<p>Consider this big Solo cup:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures/integration/big-solo-cup.jpg" class="img-fluid figure-img"></p>
<figcaption>Solo cup</figcaption>
</figure>
</div>
<p>It has approximate dimensions: smaller radius 5 feet, upper radius 8 feet and height 15 feet. How many gallons is it? At <span class="math inline">\(8\)</span> pounds a gallon this would be pretty heavy!</p>
<p>Two facts are useful:</p>
<ul>
<li>a cubic foot is 7.48052 gallons</li>
<li>the radius as a function of height is <span class="math inline">\(r(h) = 5  + (3/15)\cdot h\)</span></li>
</ul>
<pre class="{julia}"><code>#| echo: false
gft = 7.48052
r(h) = 5 + (3/15)*h
a,err = quadgk(h -&gt; pi*r(h)^2, 0, 15)
val = a*gft
numericq(val, 1e1)</code></pre>
</section>
</section>
</section>
<section id="example-arc-length" class="level2" data-number="10.7">
<h2 data-number="10.7" class="anchored" data-anchor-id="example-arc-length"><span class="header-section-number">10.7</span> Example, arc length</h2>
<p>The basic indefinite integral for a positive function answers the amount of area under the curve over a given interval. However, the integral can be interpreted in many different ways. For example, one can use an integral to answer how long a curve is. Of course one can estimate this answer. For example, consider this curve:</p>
<pre class="{julia}"><code>#| fig-alt: plot of x^2 over (0,1)
plot(x -&gt; x^2, 0, 1)</code></pre>
<p>This curve has length no more than <span class="math inline">\(2 = 1 + 1\)</span> – the distance along the <span class="math inline">\(x\)</span> axis starting at <span class="math inline">\(0\)</span> to <span class="math inline">\(1\)</span> and then going up. It is also longer than <span class="math inline">\(\sqrt{2} = \sqrt{1^2 + 1^2}\)</span> – the straight line distance between the two endpoints. But how long is it?</p>
<p>In general, the <em>arc length</em> of the curve <span class="math inline">\(y=f(x)\)</span> between <span class="math inline">\(a \leq x \leq b\)</span> (or how long is the curve) is given through the formula</p>
<p><span class="math display">\[
l = \int_a^b \sqrt{1 + f'(x)^2} dx
\]</span></p>
<p>The formula is from the length of the hypotenuse of a right triangle with lengths <span class="math inline">\(1\)</span> and <span class="math inline">\(f'(x)\)</span>, This image suggests an approximation for the length and why the hypotenuse of some triangle might be involved.</p>
<p><a href="figures/integration/arclength.gif">Arc length</a></p>
<p>Rather than focus on a derivation, we do some examples illustrating that to compute the arclength of the graph of a function is relatively straightforward using numeric integration. For example, our answer for <span class="math inline">\(f(x) = x^2\)</span> is given by</p>
<pre class="{julia}"><code>f(x) = x^2
quadgk(x -&gt; sqrt(1 + f'(x)^2), 0, 1)      # using f' notation defined in MTH229</code></pre>
<p>(We use an <em>anonymous function</em> for the integrand which involved the derivative being found through <code>f'</code>. If the graph is described by <code>f</code>, then this expression be the same for all these problems.)</p>
<hr>
<p>Whereas, the length of the <span class="math inline">\(f(x) = \sin(x)\)</span> over <span class="math inline">\([0, \pi]\)</span> would be:</p>
<pre class="{julia}"><code>f(x) = sin(x)
quadgk(x -&gt; sqrt(1 + f'(x)^2), 0, pi)</code></pre>
<p>Next we look at a more practical problem.</p>
<section id="example-the-catenary-shape" class="level3" data-number="10.7.1">
<h3 data-number="10.7.1" class="anchored" data-anchor-id="example-the-catenary-shape"><span class="header-section-number">10.7.1</span> Example: the catenary shape</h3>
<p>A <a href="http://en.wikipedia.org/wiki/Catenary">catenary shape</a> is the shape a hanging chain will take as it is suspended between two posts. It appears elsewhere, for example, power wires will also have this shape as they are suspended between towers. A formula for a catenary can be written in terms of the hyperbolic cosine, <code>cosh</code> in <code>Julia</code> or exponentials.</p>
<p><span class="math display">\[
y = a \cosh(x/a) = a \cdot \frac{e^{x/a} + e^{-x/a}}{2}.
\]</span></p>
<p>Suppose we have the following wire hung between <span class="math inline">\(x=-1\)</span> and <span class="math inline">\(x=1\)</span> with <span class="math inline">\(a = 2\)</span>:</p>
<pre class="{julia}"><code>#| fig-alt: plot of a *cosh(x/a) over (-1,1) with a=2
f(x; a=2) = a * cosh(x/a)
plot(f, -1, 1)</code></pre>
<p>How long is the chain? Looking at the graph we can guess an answer is between <span class="math inline">\(2\)</span> and <span class="math inline">\(2.5\)</span>, say, but it isn’t much work to get the answer:</p>
<pre class="{julia}"><code>quadgk(x -&gt; sqrt(1 + f'(x)^2), -1, 1)</code></pre>
</section>
<section id="practice-5" class="level3" data-number="10.7.2">
<h3 data-number="10.7.2" class="anchored" data-anchor-id="practice-5"><span class="header-section-number">10.7.2</span> Practice</h3>
<section id="question-18" class="level4">
<h4 class="anchored" data-anchor-id="question-18">Question</h4>
<p>The sag in the chain is adjusted through the parameter <span class="math inline">\(a\)</span> – chains with larger <span class="math inline">\(a\)</span> have less sag.</p>
<p>Suppose your chain has parameter <code>a=3</code> what is the length? (Use <code>quadgk</code>)</p>
<pre class="{julia}"><code>#| echo: false
f(x; a=3) = a*cosh(x/a);
val = quadgk(x -&gt; sqrt(1 + f'(x)^2), -1, 1)[1];
numericq(val, .001)</code></pre>
</section>
<section id="question-in-the-artist-studio" class="level4">
<h4 class="anchored" data-anchor-id="question-in-the-artist-studio">Question: in the artist studio</h4>
<p>This picture of Jasper Johns <a href="http://www.artic.edu/aic/collections/artwork/184095">Near the Lagoon</a> was taken at The Art Institute Chicago.</p>
<p><a href="figures/integration/johns-catenary.jpg">Jasper Johns</a></p>
<p>The museum notes have</p>
<blockquote class="blockquote">
<p>For his Catenary series (1997–2003), of which Near the Lagoon is the largest and last work, Johns formed catenaries—a term used to describe the curve assumed by a cord suspended freely from two points—by tacking ordinary household string to the canvas or its supports.</p>
</blockquote>
<p>This particular catenary has a certain length. The basic dimensions are 78in wide and 118in drop. If our shifted function is</p>
<p><span class="math display">\[
f(x; a, b) = a \cosh(x/a) - b
\]</span></p>
<p>Then we have <span class="math inline">\(f(0) = -118\)</span> and <span class="math inline">\(f(78/2) = 0\)</span> using the origin midway between the two tops of the curve. Solving the first gives</p>
<p><span class="math display">\[
-118 = a - b \text{ or } b = a + 118.
\]</span></p>
<p>The second gives <span class="math inline">\(a \cdot \cosh(78/(2a)) - (a + 118) = 0\)</span>. This can be solved numerically for a:</p>
<pre class="{julia}"><code>catenary(x; a=1, b=0) = a*cosh(x/a) - b
a = newton(a -&gt; catenary(78/2, a=a, b=118 + a), 1)</code></pre>
<p>Rounding, we take <span class="math inline">\(a=13\)</span>. With these parameters (<span class="math inline">\(a=13\)</span>, <span class="math inline">\(b = 131\)</span>), compute the length of John’s catenary.</p>
<pre class="{julia}"><code>#| echo: false
a = 13
b = 118 + a
f(x) = catenary(x, a=13, b=118+13)
val = quadgk(x -&gt; sqrt(1 + f'(x)^2), -78/2, 78/2)[1];
numericq(val, 1)</code></pre>
</section>
<section id="question-bridges-are-parabolas" class="level4">
<h4 class="anchored" data-anchor-id="question-bridges-are-parabolas">Question: bridges are parabolas</h4>
<p>Suspension bridges, like the Verrazano bridge, have different loading than a cable and hence a different shape. A parabola is the shape the cable takes under uniform loading.</p>
<p>The Verrazano-Narrows <a href="http://observer.com/2012/09/staten-island/s-i-8/">bridge</a> has a span of 1298m. Suppose the drop of the main cables is 147 meters over this span. Then the cable itself can be modeled as a parabola with</p>
<ul>
<li><span class="math inline">\(x\)</span>-intercepts <span class="math inline">\(a = 1298/2\)</span> and <span class="math inline">\(-a\)</span> and</li>
<li>vertex <span class="math inline">\((0,b)\)</span> with <span class="math inline">\(b=-147\)</span>.</li>
</ul>
<p>The parabola that fits these three points is</p>
<p><span class="math display">\[
y = \frac{-b}{a^2}(x^2 - a^2)
\]</span></p>
<p>Find the arc length of the cable in meters.</p>
<pre class="{julia}"><code>#| echo: false
a = 1298/2;
b = -147;
f(x) = (-b/a^2)*(x^2 - a^2);
val = quadgk(x -&gt; sqrt(1 + f'(x)^2), -a, a)[1]
numericq(val, 1e-3)</code></pre>
<p>In the picture of the Verrazano-Narrows <a href="http://observer.com/2012/09/staten-island/s-i-8/">bridge</a>, would the shape during construction be a parabola or a catenary?</p>
<pre class="{julia}"><code>#| echo: false
choices = ["A parabola, as just mentioned",
"A catenary, basically, as in the picture there is basically no load on the cables."
]
answer = 2
radioq(choices, answer)</code></pre>
</section>
<section id="question-the-tractrix" class="level4">
<h4 class="anchored" data-anchor-id="question-the-tractrix">Question: the tractrix</h4>
<p>A boat sits at the point <span class="math inline">\((a, 0)\)</span> and a man holds a rope taut attached to the boat at the origin <span class="math inline">\((0,0)\)</span>. The man walks on the <span class="math inline">\(y\)</span> axis. The position <span class="math inline">\(y\)</span> depends then on the position <span class="math inline">\(x\)</span> of the boat, and if the rope is taut, the position satisfies:</p>
<p><span class="math display">\[
y = a \ln\frac{a + \sqrt{a^2 - x^2}}{x} - \sqrt{a^2 - x^2}
\]</span></p>
<p>This can be entered into <code>Julia</code> as:</p>
<pre class="{julia}"><code>g(x, a) = a * log((a + sqrt(a^2 - x^2))/x) - sqrt(a^2 - x^2)</code></pre>
<p>Let <span class="math inline">\(a=12\)</span>, <span class="math inline">\(f(x) = g(x, a)\)</span>. Compute the length the bow of the boat has traveled between <span class="math inline">\(x=1\)</span> and <span class="math inline">\(x=a\)</span> using <code>quadgk</code>.</p>
<pre class="{julia}"><code>#| echo: false
a = 12
f(x) = g(x, a);
val =quadgk(x -&gt; sqrt(1 + f'(x)^2), 1, a)[1];
numericq(val, 1e-3)</code></pre>
<p>(The most elementary description of this curve is in terms of the relationship <span class="math inline">\(dy/dx = -\sqrt{a^2-x^2}/x\)</span> which could be used in place of <code>f'</code> in your work.)</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
More on the tractrix
</div>
</div>
<div class="callout-body-container callout-body">
<p>Watch this <a href="https://simonsfoundation.org/multimedia/mathematical-impressions-bicycle-tracks/%22%3E%22bicycle%20tracks">video</a> to see an example of how the tractrix can be found in an everyday observation. Also <a href="http://calteches.library.caltech.edu/4007/1/Calculus.pdf">here</a>.</p>
</div>
</div>
</section>
</section>
</section>
<section id="gauss-quadrature-using-weights" class="level2" data-number="10.8">
<h2 data-number="10.8" class="anchored" data-anchor-id="gauss-quadrature-using-weights"><span class="header-section-number">10.8</span> Gauss quadrature, Using weights</h2>
<p>What components go into the <code>quadgk</code> function? This section covers some of the background.</p>
<p>The trapezoid rule can be rearranged to become:</p>
<p><span class="math display">\[
\delta f(x_0) + 2\delta f(x_2) + 2 \delta f(x_3) + \cdots + 2 \delta f(x_{n}) + \delta f(x_{n})
\]</span></p>
<p>where <span class="math inline">\(\delta = (b-a)/n\)</span>.</p>
<p>Whereas for even <span class="math inline">\(n\)</span>, Simpson’s rule can be written with:</p>
<p><span class="math display">\[
\delta f(x_0) + 4\delta f(x_1) + 2 \delta f(x_2) + \cdots +  4 \delta f(x_{n-2}) + 2 \delta f(x_{n-1}) + \delta f(x_{n})
\]</span></p>
<p>with <span class="math inline">\(\delta = (b-a)/n \cdot (1/6)\)</span>.</p>
<p>These both have the general form of</p>
<p><span class="math display">\[
\sum_k w_k \cdot f(x_k)
\]</span></p>
<p>where <span class="math inline">\(w_k\)</span> are weights and the <span class="math inline">\(x_k\)</span> some choice of points (nodes) – not necessarily evenly spaced, though that is so in the examples we’ve seen. So, an alternative way to do the trapezoid formula in <code>Julia</code> for <span class="math inline">\(n=4\)</span> might be:</p>
<pre class="{julia}"><code>a, b, n = 0, 1, 4
delta = (b-a)/n
f(x) = x^2
wts = [1, 2, 2, 2, 1] * delta ## delta * [1, repeat([2],n-1), 1]'
xs = a .+ (0:n) * delta
sum(w * f(x) for (w,x) in zip(wts, xs))</code></pre>
<p>The compact code of the last line to compute the approximate integral shows there are three important things in this form of the integral: the weights, the <em>nodes</em> or <span class="math inline">\(x\)</span> values, and the function. The use of equally spaced nodes has been used by us so far, but it need not be the case. If fact Gauss showed he could get similar answers faster if it wasn’t the case.</p>
<p>The Gauss nodes and weights are computable (http://en.wikipedia.org/wiki/Gaussian_quadrature). The main tools are the so-called Legendre polynomials, which can be defined recursively with Bonnet’s formula:</p>
<p><span class="math display">\[
P_0(x) = 1; P_1(x) = x; \quad  n P_{n}(x)  = (2(n-1)+1) x P_{n-1}(x) -(n-1) P_{n-2}(x).
\]</span></p>
<p>Using <code>Julia</code>’s <code>Polynomials</code> package this can be implemented almost verbatim:</p>
<pre class="{julia}"><code>import Polynomials
import Polynomials: Polynomial
function lgp(n::Integer)
    if n == 0 return Polynomial([1]) end
    if n == 1 return Polynomial([0, 1]) end

    (2*(n-1) + 1) / n * lgp(1) * lgp(n-1) - (n-1)/n * lgp(n-2)
end</code></pre>
<p>This is used as,</p>
<pre class="{julia}"><code>p4 = lgp(4)</code></pre>
<p>The term <em>recursion</em> is applied to a function when it makes a reference to itself during a computation. With this function, don’t try it with values much bigger than <span class="math inline">\(20\)</span>, as the recursion can take a long time.</p>
<p>The nodes are the roots of the right polynomial. Here we have the values for <code>p4</code></p>
<pre class="{julia}"><code>xs = Polynomials.roots(p4)</code></pre>
<p>(The Konrod part of <code>quadgk</code> changes the nodes so they can be reused during the refinement.)</p>
<p>Finally, the weights involve the derivative of <span class="math inline">\(P_n\)</span> through:</p>
<p><span class="math display">\[
w_i = \frac{2}{(1 - x_i^2) \cdot(P^{'}_n(x_i)/P_n(1))^2}
\]</span></p>
<p>These can be done simply with:</p>
<pre class="{julia}"><code>weights(x) = 2 / ((1 - x^2) * (Polynomials.derivative(p4)(x)/p4(1))^2 )
ws = [weights(xi) for xi in xs]</code></pre>
<p>From here <code>gauss_quadrature</code> will do the integration of <code>f</code> over the interval <span class="math inline">\([-1,1]\)</span>, though we can do it ourself quickly enough. Here we compute the integral of <span class="math inline">\(\cos(\pi/2 x)\)</span> over <span class="math inline">\([-1,1]\)</span> (you can check this is very close to the answer <span class="math inline">\(4/\pi\)</span> even with just 4 nodes):</p>
<pre><code>f(x) = cos(pi/2*x)
sum(w * f(x) for (w,x) in zip(ws, xs))</code></pre>
<section id="adaptive-integration" class="level3" data-number="10.8.1">
<h3 data-number="10.8.1" class="anchored" data-anchor-id="adaptive-integration"><span class="header-section-number">10.8.1</span> Adaptive integration</h3>
<p>Next, we a have a brief discussion about an alternative means to compute integrals. The following function <code>adapt</code> implements a basic <em>adaptive quadrature</em> method for integration. The basic idea is that for a subinterval <span class="math inline">\([a,b]\)</span> if the area of the trapezoid is not close to the area of Simpson’s parabolic estimate then the subinterval is split into two pieces <span class="math inline">\([a,c]\)</span> and <span class="math inline">\([c,b]\)</span> and the same question is asked. If the area is close the Simpson’s parabolic estimate is used to estimate the integral of <span class="math inline">\(f\)</span> over that subinterval.</p>
<p>Again, we see <em>recursion</em> when programming this algorithm. To avoid infinite loops during this, we use a limit below to keep track.</p>
<p>In general, the value of adaptive methods like this, is the function calls concentrate on areas where <span class="math inline">\(f\)</span> is not well approximated and where it is well approximated it just moves on. This approach works well for poorly behaved functions, as it has a more refined grid there.</p>
<pre class="{julia}"><code>#| echo: false
#from the MASS function adapt
nothing</code></pre>
<pre class="{julia}"><code>function adapt(f, a, b, limit)

    h = b-a
    c = a + (b - a)/2

    a1 = (f(a) + f(b)) * h/2          ## trapezoid
    a2 = (f(a) + 4f(c) + f(b)) * h/6  ## Simpson's parabola

    if isapprox(a1, a2)
        return(a2)
    end

    if limit == 0
        println("limit reached for this interval [$a, $b]")
    return(a2)
    end

    adapt(f, a, c, limit - 1) + adapt(f, c, b, limit-1)
end</code></pre>
<p>Does it work? Let’s see it for the area of <span class="math inline">\(f(x) = x^2(1-x)^{10}\)</span> which is known to satisfy <span class="math inline">\(\beta(2+1, 10+1)\)</span></p>
<pre><code>out = adapt(x -&gt; x^2 * (1 -x)^10, 0, 1, 10)</code></pre>
<p>Not too far off (<code>1e-10</code>) from the known answer which is a beta function:</p>
<pre><code>out - beta(2 + 1, 10 + 1)</code></pre>
<p>(The use of <code>isapprox</code> above determines how accurate the values will be. This function uses two tolerances to test if the valus <code>x</code> and <code>y</code> are approximately the same. These could be changed easily enough so that more precise answers can be found.)</p>
<hr>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Environment of <code>Julia</code> when generated
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><code>Julia</code> version:</p>
<pre class="{julia}"><code>VERSION</code></pre>
<p>Packages and versions:</p>
<pre class="{julia}"><code>using Pkg
Pkg.status()</code></pre>
</div>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./extrema.html" class="pagination-link" aria-label="Maximization and minimization with Julia">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Maximization and minimization with Julia</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./symbolic-math.html" class="pagination-link" aria-label="Using symbolic math within Julia">
        <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Using symbolic math within Julia</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/MTH229/mth229.github.io/edit/master/quarto/integration.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/MTH229/mth229.github.io/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div></div></footer><script src="https://cdn.jsdelivr.net/gh/yasserelsaid/chatbot@v0.1.4/index.min.js" data-chatbotid="index-pdf-k527qtaap"></script>




</body></html>